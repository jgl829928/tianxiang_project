webpackJsonp([2],{FGcY:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,n=a("Xxa5"),i=a.n(n),r=a("exGp"),l=a.n(r),c=(a("XLwt"),a("Oa8A")),o=a("H+Xr"),u=a("VsUZ"),d=a("TIfe"),f={name:"Sampling",components:{LineChart:c.a,selectServer:o.a},data:function(){return{name:"sampling",reqdata:{selectId:""},id:"",baseInfo:[],timeInterval:"",cpuData:{},diskData:{},pingData:{},ramData:{},fileList:[],type:"cpu",seconds:30,fileInterval:"",fileUrl:"",file_dialog:!1,isOpen:!1}},beforeRouteLeave:function(e,t,a){clearInterval(this.timeInterval),clearInterval(this.fileInterval),a()},methods:{search:Object(d.a)(function(e){if(!e)return!1;this.id=e,clearInterval(this.timeInterval),this.getLineData(),this.getOldFile(),this.timeInterval=setInterval(this.getLineData,5e3)},500),getLineData:function(){var e=this;return l()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get(u.b.samInfo+"?serverid="+e.id);case 2:(a=t.sent)&&1===a.Code&&(e.baseInfo=a.Data,s=e.baseInfo.historymap,e.cpuData=e.delData(s.CPU,"CPU"),e.diskData=e.delData(s.DISK,"DISK"),e.pingData=e.delData(s.PING,"PING"),e.ramData=e.delData(s.RAM,"RAM"));case 4:case"end":return t.stop()}},t,e)}))()},delData:function(e,t){var a=[],s=[];return e.map(function(e){"PING"===t&&(e.Utilization=e.Utilization/1e6),a.push(Object(d.o)(1e3*e.RecordTime,"hour")),s.push(e.Utilization)}),{timeData:a,numData:s,name:t,rotate:!1}},submitForm:Object(d.a)(function(){this.getNewFile()},500),getOldFile:function(){var e=this;this.$http.get(u.b.samFile+"?serverid="+this.id).then(function(t){t&&1===t.Code&&(e.fileList=t.Data.filelist||[],!e.fileList||e.fileList.length)})},getNewFile:function(){var e=this,t="serverid="+this.id+"&sampling="+this.type;t="cpu"==this.type?t+"&seconds="+this.seconds:t,this.$http.get(u.b.createFile+"?"+t).then(function(t){t&&1===t.Code&&(e.fileList=t.Data.filelist||[])})},handleOpen:Object(d.a)((s=l()(i.a.mark(function e(t,a){var s,n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isOpen=!0,setTimeout(function(){n.isOpen=!1},3e3),e.next=4,this.$http.get(u.b.openFile+"?file="+a);case 4:if((s=e.sent)&&1===s.Code){e.next=7;break}return e.abrupt("return",!1);case 7:this.heartCheck(),clearInterval(this.fileInterval),this.fileInterval=setInterval(this.heartCheck,1e4),setTimeout(function(){n.getSource(),n.isOpen=!1},2e3);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)}),500),file_close:function(){var e=this;return l()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return clearInterval(e.fileInterval),t.next=3,e.$http.get(u.b.closeFile);case 3:t.sent;case 4:case"end":return t.stop()}},t,e)}))()},heartCheck:function(){var e=this;return l()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get(u.b.heartCheck);case 2:t.sent;case 3:case"end":return t.stop()}},t,e)}))()},getSource:function(){var e=this;return l()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=(new Date).getTime(),e.fileUrl=u.b.openLink+"?accesstoken="+e.$store.state.token+"&time="+a,e.file_dialog=!0;case 3:case"end":return t.stop()}},t,e)}))()},handleDelete:function(e,t){var a=this;this.$confirm("请确认是否删除","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){var e=a;Object(d.a)(function(){e.delRequest(t)},500)()})},delRequest:function(e){var t=this;this.$http.get(u.b.delFile+"?file="+e).then(function(e){e&&1===e.Code&&(t.$message({message:"删除成功",type:"success",duration:1e3}),t.getOldFile())})}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"sampling",staticClass:"chart_content"},[a("select-server",{attrs:{reqdata:e.reqdata,name:e.name},on:{getserver:e.search}}),e._v(" "),a("div",{staticClass:"chart_grid"},[a("el-row",[a("el-col",{staticClass:"left_grid",attrs:{span:16,xs:24}},[a("div",{staticClass:"frame"},[a("div",{staticClass:"frameTop"},[a("span",{staticClass:"frameName"},[e._v("BASE INFO")])]),e._v(" "),a("div",{staticClass:"frameDiv"},[a("table",{staticClass:"tables"},[a("tr",[a("td",[e._v("ID")]),e._v(" "),a("td",[e._v(e._s(e.baseInfo.id))])]),e._v(" "),a("tr",[a("td",[e._v("IP")]),e._v(" "),a("td",[e._v(e._s(e.baseInfo.ip))])])]),e._v(" "),a("table",{staticClass:"tables"},[a("tr",[a("td",[e._v("NAME")]),e._v(" "),a("td",[e._v(e._s(e.baseInfo.name))])]),e._v(" "),a("tr",[a("td",[e._v("TYPE")]),e._v(" "),a("td",[e._v(e._s(e.baseInfo.type))])])])])]),e._v(" "),a("div",{staticClass:"lineCharts"},[a("el-row",[a("el-col",{attrs:{span:12,xs:24}},[a("LineChart",{attrs:{lineData:e.cpuData}})],1),e._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("LineChart",{attrs:{lineData:e.diskData}})],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12,xs:24}},[a("LineChart",{attrs:{lineData:e.pingData}})],1),e._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("LineChart",{attrs:{lineData:e.ramData}})],1)],1)],1)]),e._v(" "),a("el-col",{attrs:{span:8,xs:24}},[a("div",{staticClass:"frame fileTable"},[a("div",{staticClass:"frameTop"},[a("span",{staticClass:"frameName"},[e._v("FileList")])]),e._v(" "),a("el-form",{ref:"reqform",staticClass:"second_form",attrs:{"status-icon":"","label-width":"65px","hide-required-asterisk":""}},[a("el-row",[a("el-col",{attrs:{span:10,xs:24}},[a("el-form-item",{attrs:{label:"Type",prop:"seconds"}},[a("el-select",{attrs:{placeholder:"请选择类型"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[a("el-option",{attrs:{label:"CPU",value:"cpu"}}),e._v(" "),a("el-option",{attrs:{label:"RAM",value:"ram"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:10,xs:24}},["cpu"==e.type?a("el-form-item",{attrs:{label:"Seconds",prop:"seconds"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1,max:30},model:{value:e.seconds,callback:function(t){e.seconds=t},expression:"seconds"}})],1):e._e()],1),e._v(" "),a("el-col",{attrs:{span:4,xs:24}},[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("reqform")}}},[e._v("submit")])],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"frame_content"},[a("el-table",{staticClass:"level_tab tables",staticStyle:{width:"100%"},attrs:{data:e.fileList,"max-height":"580"}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"File Name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"Name",align:"center",label:"option",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"common_btn",attrs:{type:"success",size:"small",plain:"",disabled:e.isOpen},on:{click:function(a){return e.handleOpen(t.$index,t.row)}}},[e._v("open")]),e._v(" "),a("el-button",{staticClass:"el-icon-delete delete_btn",attrs:{type:"danger",size:"small",plain:""},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("delete")])]}}])})],1)],1)],1)])],1)],1),e._v(" "),a("el-dialog",{staticClass:"file_dailog",attrs:{visible:e.file_dialog,width:"80%",center:""},on:{"update:visible":function(t){e.file_dialog=t},close:e.file_close}},[a("iframe",{attrs:{src:e.fileUrl,frameborder:"0",width:"100%",height:"800"}})])],1)},staticRenderFns:[]};var v=a("VU/8")(f,p,!1,function(e){a("zAQD"),a("fDSL")},"data-v-93185b40",null);t.default=v.exports},"H+Xr":function(e,t,a){"use strict";var s=a("Xxa5"),n=a.n(s),i=a("exGp"),r=a.n(i),l=a("VsUZ"),c={name:"selectServer",props:["reqdata","name","disabled"],data:function(){return{serverList:[],typeList:[]}},mounted:function(){this.getData()},methods:{getData:function(){var e=this;return r()(n.a.mark(function t(){var a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get(l.b[e.name]);case 2:(a=t.sent)&&1===a.Code&&(e.serverList=a.Data.serverlist||[],"worldmap"==e.name&&e.$emit("typeList",a.Data.mapcitytypelist));case 4:case"end":return t.stop()}},t,e)}))()},search:function(){this.$emit("getserver",this.reqdata.selectId)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"select_server"},[a("span",{staticClass:"left_name"},[e._v("id")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reqdata.selectId,callback:function(t){e.$set(e.reqdata,"selectId",t)},expression:"reqdata.selectId"}},e._l(e.serverList,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})}),1),e._v(" "),a("el-button",{staticClass:"right_btn",attrs:{type:"info",plain:"",icon:"el-icon-search",disabled:e.disabled},on:{click:e.search}})],1)},staticRenderFns:[]},u=a("VU/8")(c,o,!1,null,null,null);t.a=u.exports},fDSL:function(e,t){},zAQD:function(e,t){}});
//# sourceMappingURL=2.972a721f63b09556dcbe.js.map