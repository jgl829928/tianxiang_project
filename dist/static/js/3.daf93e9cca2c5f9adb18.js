webpackJsonp([3],{"70+B":function(e,t){},"H+Xr":function(e,t,a){"use strict";var r=a("Xxa5"),n=a.n(r),i=a("exGp"),s=a.n(i),l=a("VsUZ"),o={name:"selectServer",props:["reqdata","name","disabled"],data:function(){return{serverList:[],typeList:[]}},mounted:function(){this.getData()},methods:{getData:function(){var e=this;return s()(n.a.mark(function t(){var a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get(l.b[e.name]);case 2:(a=t.sent)&&1===a.Code&&(e.serverList=a.Data.serverlist||[],"worldmap"==e.name&&e.$emit("typeList",a.Data.mapcitytypelist));case 4:case"end":return t.stop()}},t,e)}))()},search:function(){this.$emit("getserver",this.reqdata.selectId)}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"select_server"},[a("span",{staticClass:"left_name"},[e._v("id")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reqdata.selectId,callback:function(t){e.$set(e.reqdata,"selectId",t)},expression:"reqdata.selectId"}},e._l(e.serverList,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})}),1),e._v(" "),a("el-button",{staticClass:"right_btn",attrs:{type:"info",plain:"",icon:"el-icon-search",disabled:e.disabled},on:{click:e.search}})],1)},staticRenderFns:[]},p=a("VU/8")(o,c,!1,null,null,null);t.a=p.exports},KP4Z:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mvHQ"),n=a.n(r),i=a("Xxa5"),s=a.n(i),l=a("exGp"),o=a.n(l),c=a("//Fk"),p=a.n(c),u=a("BO1k"),d=a.n(u),m=a("VsUZ"),v=a("TIfe"),h=a("XLwt"),f=a.n(h),y={name:"Worldmap",components:{selectServer:a("H+Xr").a},data:function(){return{imgStr:"",reqdata:{selectId:""},isDisable:!1,name:"worldmap",serverlist:[],serverId:"",typeList:[],type:"",allpoints:[],points:[],pointsNum:0,loading:!1}},computed:{pointsList:function(){var e=this.points,t=!0,a=!1,r=void 0;try{for(var n,i=d()(e);!(t=(n=i.next()).done);t=!0){var s=n.value;s.value[1]=880-s.value[1]}}catch(e){a=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(a)throw r}}return e}},mounted:function(){this.imgBase64()},methods:{imgBase64:function(){var e=this;p.a.resolve(Object(v.d)()).then(function(t){e.imgStr=t}).then(function(){e.inialLine()})},getType:function(e){this.typeList=e},search:Object(v.a)(function(e){if(this.serverId=e,!this.serverId)return this.$message.error("请选择服务器ID"),!1;this.type="",this.isDisable=!0,this.loading=!0,this.getpointData()},500),getpointData:function(e){var t=this;return o()(s.a.mark(function e(){var a,r,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],r=0;r<121;r++)a.push(t.$http.post(m.b.mapBolck+"?server="+t.serverId+"&block="+r));return e.next=4,p.a.all(a);case 4:n=e.sent,t.dealdata(n);case 6:case"end":return e.stop()}},e,t)}))()},dealdata:function(e){this.isDisable=!1;var t=[],a=!0,r=!1,i=void 0;try{for(var s,l=d()(e);!(a=(s=l.next()).done);a=!0){var o=s.value;if(o.Data.block&&"null"!=o.Data.block){o.Data.block=JSON.parse(o.Data.block);var c=!0,p=!1,u=void 0;try{for(var m,v=d()(o.Data.block);!(c=(m=v.next()).done);c=!0){var h=m.value,f={name:h.RID,cType:h.CType,cName:this.getName(h.CType).CName,level:h.Level,value:[h.X,h.Y]};t.push(f)}}catch(e){p=!0,u=e}finally{try{!c&&v.return&&v.return()}finally{if(p)throw u}}}}}catch(e){r=!0,i=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw i}}this.allpoints=JSON.parse(n()(t)),this.renderMap(t)},typechange:function(){var e=this,t=[];t=this.type?this.allpoints.filter(function(t){return e.type==t.cType}):this.allpoints,this.renderMap(t)},renderMap:function(e){this.points=JSON.parse(n()(e)),this.pointsNum=this.points.length,this.inialLine()},getName:function(e){var t={},a=!0,r=!1,n=void 0;try{for(var i,s=d()(this.typeList);!(a=(i=s.next()).done);a=!0){var l=i.value;if(e==l.CType){t=l;break}}}catch(e){r=!0,n=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw n}}return t},inialLine:function(){var e=new Image,t=document.createElement("canvas"),a=t.getContext("2d"),r=f.a.init(document.querySelector(".map .mapitem"));t.width=r.getWidth(),t.height=r.getHeight();var n=new Image;e.onload=function(){a.drawImage(e,0,0,t.width,t.height),n.src=t.toDataURL(),setTimeout(function(){r.resize()},100)},e.src=this.imgStr;var i="geoMap"+Math.round(1e10*Math.random()),s={type:"FeatureCollection",features:[{type:"Feature",properties:{name:i},geometry:{type:"MultiPolygon",coordinates:[[[[880,880],[0,880],[0,0],[880,0]]]]}}]};f.a.registerMap(i,s),r.setOption({tooltip:{trigger:"item",confine:!0,show:!0,formatter:function(e){return"rid:"+e.data.name+"</br>X:"+e.value[0]+"</br>Y:"+(880-e.value[1])+"<br/>level:"+e.data.level+"<br>type:"+e.data.cName}},geo:{map:i,aspectScale:1,layoutCenter:["50%","50%"],layoutSize:880,silent:!0,roam:!0,scaleLimit:{min:1},itemStyle:{borderWidth:0,color:{image:n,repeat:"no-repeat"}}},series:[{type:"scatter",coordinateSystem:"geo",symbol:"rect",itemStyle:{normal:{opacity:.4,color:"#fff"}},symbolSize:10,data:this.pointsList,large:!0}]}),this.loading=!1}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"common_content map_content"},[a("select-server",{attrs:{reqdata:e.reqdata,name:e.name,disabled:e.isDisable},on:{getserver:e.search,typeList:e.getType}}),e._v(" "),a("div",{staticClass:"map",attrs:{id:"map"}},[a("el-form",{staticClass:"c-type-form",attrs:{"label-width":"100px",inline:!0,"label-position":"right"}},[a("el-row",[a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"Type","min-width":"120"}},[a("el-select",{attrs:{clearable:"",placeholder:"Type"},on:{change:e.typechange},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},e._l(e.typeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.CName,value:e.CType}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"Num","min-width":"120"}},[a("span",[e._v(e._s(e.pointsNum))])])],1)],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"mapitem",attrs:{id:"mapitem"}})],1)],1)},staticRenderFns:[]};var b=a("VU/8")(y,g,!1,function(e){a("aViZ"),a("70+B")},"data-v-423b8887",null);t.default=b.exports},aViZ:function(e,t){}});
//# sourceMappingURL=3.daf93e9cca2c5f9adb18.js.map